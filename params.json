{"name":"mtd","tagline":"Just-in-time dependency injection of command line options for executable contexts in Node.js","body":"<p align=\"center\">\r\n  <a href=\"https://www.npmjs.com/package/mtd\">\r\n    <img src=\"http://i.imgur.com/t4OEBmj.gif\" />\r\n  </a>\r\n</p>\r\n\r\n# MTD\r\n\r\n**Multi-track drifting for your command line applications**\r\n\r\n[![NPM version][npm-image]][npm-url] [![Downloads][npm-downloads]][npm-url]\r\n\r\nJust-in-time dependency injection of command line options for executable contexts in Node.js.\r\n\r\nCurious? All aboard!\r\n\r\n1. <a href=\"#whatis\">What is MTD?</a>\r\n1. <a href=\"#install\">Installation</a>\r\n1. <a href=\"#info\">Example & Basic Info</a>\r\n  - <a href=\"#missing\">Missing links</a>\r\n  - <a href=\"#order\">Execution Order & Multi-tracks</a>\r\n1. <a href=\"#usage\">Usage & Documentation</a>\r\n  - <a href=\"#requiring\">Requiring</a>\r\n  - <a href=\"#construction\">Construction</a>\r\n  - <a href=\"#properties\">Properties</a>\r\n  - <a href=\"#methods\">Methods</a>\r\n  - <a href=\"#context\">Track context</a>\r\n  - <a href=\"#parsing\">Parsed dependencies</a>\r\n1. <a href=\"#extras\">Extras</a>\r\n1. <a href=\"#license\">License</a>\r\n\r\n<a name=\"whatis\"></a>\r\n## What is MTD?\r\n\r\nMore formally, MTD stands for _managing terminal dependencies_ - but that's no fun.\r\n\r\nMTD is a lightweight module that wraps around [minimist][minimist], providing an intelligent way to define _tracks_ that your command line application might travel down, and allowing you to specify the command line options that each track depends upon. _Tracks_ are essentially different execution contexts that your singular command line application might want to run, and are defined as the loose arguments provided to a command line application.\r\n\r\n<a name=\"install\"></a>\r\n## Install\r\n\r\nUsing [npm](https://www.npmjs.com/), of course.\r\n\r\n```shell\r\n$ npm install mtd\r\n```\r\n\r\n<a name=\"info\"></a>\r\n## Example & Basic Info\r\n\r\nHere's an example of a simple command line application that processes dates, using MTD.\r\n\r\n```javascript\r\n// date-time.js\r\nvar station = require('mtd');\r\n\r\nfunction HMS (seconds) {\r\n  this.hours = ~~(seconds / 3600);\r\n  this.minutes = ~~((seconds % 3600) / 60);\r\n  this.seconds = ~~(seconds % 60);\r\n}\r\n\r\nHMS.prototype.pretty = function () {\r\n  console.log('Hour(s):\\t%s\\nMinute(s):\\t%s\\nSecond(s):\\t%s',\r\n    this.hours, this.minutes, this.seconds);\r\n};\r\n\r\nstation({\r\n  date: ['a valid date string']\r\n})\r\n\r\n.track('until', function (date) {\r\n  var seconds = ~~((Date.parse(date) - Date.now()) / 1000);\r\n\r\n  console.log('Time until %s', date);\r\n  new HMS(seconds).pretty();\r\n})\r\n\r\n.track('since', function (date) {\r\n  var seconds = ~~((Date.now() - Date.parse(date)) / 1000);\r\n\r\n  console.log('Time since %s', date);\r\n  new HMS(seconds).pretty();\r\n})\r\n\r\n.embark();\r\n```\r\n\r\nWith this basic example we can now test out our command line application as `node date-time until --date \"November 11, 2020\"` and something along the lines of\r\n\r\n```\r\nTime until November 11, 2020\r\nHour(s):\t42449\r\nMinute(s):\t22\r\nSecond(s):\t51\r\n```\r\n\r\nwill be printed to our terminal. Now the same application could be run as `node date-time since --date \"November 11, 1951\"` and we'd see\r\n\r\n```\r\nTime since November 11, 1951\r\nHour(s):\t562422\r\nMinute(s):\t40\r\nSecond(s):\t53\r\n```\r\n\r\n<a name=\"missing\"></a>\r\n### Missing links\r\n\r\nWe can see that both `tracks` depend on the command line option `date`, as shown in each function's argument list. What happens when we fail to provide that option?\r\n\r\n```\r\nRequired option(s) not found for [ until ] track:\r\n  --date\t\ta valid date string\r\n```\r\n\r\nMTD lets us know that we've failed to provide a necessary command line option, and which track required it. If we fail to provide more than one option, they are all shown.\r\n\r\n<a name=\"order\"></a>\r\n### Execution Order & Multi-tracks\r\n\r\nMTD is synchronous.\r\n\r\nTracks are executed in the order that they are passed to the command line application. There are configuration options to disable multiple tracks, and the rerunning of individual tracks.\r\n\r\nIf we ran our previous example as `node date-time since until --date \"Jan 1, 2000\"` we would see something like\r\n\r\n```\r\nTime since Jan 1, 2000\r\nHour(s):\t140430\r\nMinute(s):\t56\r\nSecond(s):\t33\r\nTime until Jan 1, 2000\r\nHour(s):\t-140430\r\nMinute(s):\t-56\r\nSecond(s):\t-33\r\n```\r\n\r\nin our terminal.\r\n\r\n<a name=\"usage\"></a>\r\n## Usage & Documentation\r\n\r\n<a name=\"requiring\"></a>\r\n### Requiring\r\n\r\nRequiring the module works very much like most `Node` modules do.\r\n\r\n```javascript\r\nvar mtd = require('mtd');\r\n```\r\n\r\nWith the previous, `mtd` is now a function (called `barrier` internally) that, when invoked, returns a new instance of `MTD`. This acts as a construction wrapper.\r\n\r\n<a name=\"construction\"></a>\r\n### Construction\r\n\r\n```javascript\r\nmtd(options :: Object)\r\n```\r\n\r\nWhen constructed, `MTD` instances take one argument - an object containing command line options as keys, and arrays as their values. These keys are arbitrary, and this object is optional. Command line options will be parsed regardless of if they exist in this object or not.\r\n\r\nThe arrays should contain only the following, in order.\r\n\r\n- [0] : A description of the option, for error/help messages.\r\n- [1] : A single character alias for the option.\r\n- [2] : A forced type to be used when parsed, either `string` or `boolean`.\r\n- [3] : A default value.\r\n\r\nTo omit any of the first three elements, set them individually as `null`.\r\n\r\n```javascript\r\nmtd({\r\n  date: ['a valid date string', 'd', 'string', 'January 1, 1970'],\r\n  timestamp: [null, 't', null, 516078000000]\r\n})\r\n```\r\n\r\n<a name=\"properties\"></a>\r\n### Properties\r\n\r\nInstances of MTD contain the following properties:\r\n\r\n- `information :: Object` - An object containing the following key-values:\r\n  - `descriptions :: Object` - A mapping of command line options to their help messages.\r\n  - `parsed :: Object` - The transformed options object for `minimist` to digest.\r\n  - `aliases :: Object` - A convenience reference to `information.parsed.alias`.\r\n- `options :: Object` - The object returned from `minimist`'s parsing of command line arguments and options.\r\n- `argv :: Array` - A convenience reference to `options._`, the loose command line arguments.\r\n- `settings :: Object` - An object containing the following key-values:\r\n  - `multi :: Boolean` - Whether multiple `tracks` can be run from the command line arguments (`options._`). Default `true`.\r\n  - `reruns :: Boolean` - Whether individual `tracks` can be run multiple times. Default `true`.\r\n  - `results :: Boolean` - Whether the most recent result of an individual `Track` should be stored in `Track.result`. Default `false`.\r\n- `tracks :: Object` - An object containing `Track` objects. Each object has the following properties:\r\n  - `block :: Function` - The execution context to be invoked.\r\n  - `departed :: Boolean` - Whether or not the `Track` has run at least once.\r\n  - `requirements :: Array` - An array of strings, corresponding to the command line options.\r\n  - `result :: Any` - The most recent return value from invoking the `Track.block`. Setting dependent.\r\n- `_radio :: Object` - An empty object, to be used for data sharing between tracks. See `MTD.prototype.radio`.\r\n- `_before :: Array` - An array of `track` string names to be invoked in order, before any command line argument tracks.\r\n- `_default :: Null/String` - The default `track` to be invoked if there are no command line argument tracks.\r\n- `_after :: Array` - An array of `track` string names to be invoked in order, after any command line argument tracks.\r\n\r\nGenerally, none of the properties should be written to directly.\r\n\r\n<a name=\"methods\"></a>\r\n### Methods\r\n\r\nMTD has the following prototype methods.\r\n\r\n#### MTD.prototype.configure\r\n\r\n```javascript\r\n.configure(config :: Object)\r\n```\r\n\r\nThis method takes an object where the values of any keys also found in the `settings` object property of the `MTD` instance will be overwritten with the values from this provided object.\r\n\r\n- Chainable: _this method returns the instance._\r\n\r\n##### Example\r\n\r\n```javascript\r\n.configure({\r\n  reruns: false,\r\n  results: true\r\n})\r\n```\r\n\r\n#### MTD.prototype.track\r\n\r\n```javascript\r\n.track(name :: String, requirements :: Array, block :: Function)\r\n```\r\n\r\nThis method creates `Track` objects, stored in the `tracks` instance property. There are three valid ways to pass arguments to this method, but a string `name` is always required as the first argument. All three styles can be seen in the example below.\r\n\r\n- Unique Input: _No two `Track` objects should be associated with the same string `name`_.\r\n- Chainable: _this method returns the instance._\r\n\r\n##### Example\r\n\r\n```javascript\r\n.track('up', ['one', 'two'], function (one, two) {\r\n  // the standard argument format.\r\n})\r\n.track('down', function (one, two) {\r\n  // with this style, a requirements array is built from parsing the source code of the given block.\r\n  // this style should be avoided if you need command line options that are not valid JavaScript identifiers.\r\n})\r\n.track('left', ['one', 'two', function (one, two) {\r\n  // with this style, the block argument is the last element of the requirements array.\r\n}])\r\n```\r\n\r\n#### MTD.prototype.default\r\n\r\n```javascript\r\n.default(name :: String, requirements :: Array, block :: Function)\r\n```\r\n\r\nSets the default `Track` to be invoked in the event that _no_ `tracks` are specified in the command line arguments. There can only be __one__ default `Track` at a given time.\r\n\r\nThis method takes arguments in a similar way to `MTD.prototype.track`, since it calls `.track` internally, but with two exceptions:\r\n\r\n- If _only_ a string `name` is provided, it is assumed an associated `Track` exists, or will soon exist, in the `tracks` instance property. `.track` is not invoked.\r\n\r\n- If no `name` is provided, a default `track` name of `'MTD_DEFAULT'` is provided with the call to `.track`.\r\n\r\nIn any event, the `_default` instance property is set to whatever `name` is decided upon.\r\n\r\n- Chainable: _this method returns the instance._\r\n\r\n#### Example\r\n\r\n```javascript\r\n.default('yo') // assumes a 'yo' Track exists, or will exist\r\n.default('yo', ['one', 'two'], function (one, two) {\r\n  // invokes MTD.prototype.track, creating or overriding a Track named 'yo'\r\n})\r\n.default(['one', 'two', function (one, two) {\r\n  // same as above, but passes 'MTD_DEFAULT' as the name argument to MTD.prototype.track\r\n}])\r\n.default(function (one, two) {\r\n  // same as above, MTD.prototype.track parses block argument requirements\r\n})\r\n```\r\n\r\n#### MTD.prototype.before\r\n\r\n```javascript\r\n.before(name :: String, requirements :: Array, block :: Function)\r\n```\r\n\r\nRegisters `Track` names to always be invoked, in order, _before_ any command line argument or `_default` tracks.\r\n\r\nThis method follows the same rules as `MTD.prototype.default`, but pushes the name of the track into the `_before` array instance property.\r\n\r\nIf `name` is not provided, a name is generated as `'MTD_BEFORE_N'` - where `N` is the current length of the `_before` array.\r\n\r\n- Chainable: _this method returns the instance._\r\n\r\n##### Example\r\n\r\n```javascript\r\n.before('first') // assumes a 'first' Track exists, or will exist\r\n.before(function (alpha, beta) {\r\n  // create a new Track called 'MTD_BEFORE_0'\r\n})\r\n```\r\n\r\n#### MTD.prototype.after\r\n\r\n```javascript\r\n.after(name :: String, requirements :: Array, block :: Function)\r\n```\r\n\r\nWorks identically to `MTD.prototype.before`, but registers `Track` names to always be invoked, in order, _after_ any command line argument or `_default` tracks.\r\n\r\nPushes `Track` names into the `_after` array instance property. Generated names take the form `'MTD_AFTER_N'`.\r\n\r\n- Chainable: _this method returns the instance._\r\n\r\n##### Example\r\n\r\n```javascript\r\n.after('last') // assumes a 'last' Track exists, or will exist\r\n.after(function (alpha, beta) {\r\n  // create a new Track called 'MTD_AFTER_0'\r\n})\r\n```\r\n\r\n#### MTD.prototype.dispatch\r\n\r\n```javascript\r\n.dispatch(track :: String)\r\n```\r\n\r\nThis method manages just-in-time dependency injection, and invocation of individual `Track` objects.\r\n\r\nIt can be used to invoke a `Track` manually.\r\n\r\n##### Example\r\n\r\n```javascript\r\n.dispatch('yo') // manually invokes the 'yo' Track\r\n```\r\n\r\n#### MTD.prototype.radio\r\n\r\n```javascript\r\n.radio(key :: String, value :: Any, protect :: Boolean)\r\n```\r\n\r\nThis is a getter/setter method for ease-of-use interaction with the `_radio` instance property. Its functionality is twofold:\r\n\r\n- If _only_ a `key` is provided, this method acts as a getter, returning the value associated with the given string.\r\n\r\n- If a `key` and a `value` are provided, this method acts as a setter, associating the given value with the given key, and returning the value.\r\n\r\n  - If `protect` is provided as a truthy value, `value` will _only_ be associated with `key` if the given `key` does not already have an associated value.\r\n\r\nThis is useful for providing values or instances of objects that multiple tracks may wish to share.\r\n\r\n##### Example\r\n\r\nIn this example, we have two `tracks` where we know we will want an instance of `MySharedObject`. We can set up a `before` track, that checks if our command line application has been passed a `key` option. With that information, and a uniform designation of the `key` option, we can set up our tracks so that if multiple `key` dependents are invoked we already have a shared object, and don't need to construct additional instances.\r\n\r\n```javascript\r\n.before(function () {\r\n  var key = this.options.key;\r\n  if (key) this.radio('instance', new MySharedObject(key));\r\n})\r\n.track('foo', function (key, alpha) {\r\n  this.radio('instance').doSomething(alpha);\r\n})\r\n.track('bar', function (key, beta) {\r\n  this.radio('instance').doSomethingElse(beta);\r\n})\r\n```\r\n\r\n#### MTD.prototype.embark\r\n\r\n```javascript\r\n.embark()\r\n```\r\n\r\nThis is the runner method, which handles dispatching `tracks` found in `_before`, `argv` or `_default`, and `_after`. It should always be called last. If you forget to include this, your application likely won't do anything.\r\n\r\n<a name=\"context\"></a>\r\n### Track context\r\n\r\nWhen invoked, `tracks` have their contextual `this` set to the controlling instance of `MTD`.\r\n\r\nThis allows for ease of access to non-dependent command line options found in the `.options` property, the `.radio` method, and any other instance properties or prototype methods your `Track` might want to use.\r\n\r\nAs such, `Track` _blocks_ should not be object methods, or a function where the contextual `this` would need to be bound elsewhere in order for the function to operate properly.\r\n\r\n<a name=\"parsing\"></a>\r\n### Parsed dependencies\r\n\r\nTo omit `Track` dependency lists, and rely on parsing function arguments, functions should conform to ES5 style arguments. No fancy ES6 allowed.\r\n\r\n<a name=\"extras\"></a>\r\n## Extras\r\n\r\n- [`mtd-help`](https://github.com/Okahyphen/mtd-help) - A helpful `Track`.\r\n\r\n<a name=\"license\"></a>\r\n## License\r\n\r\nMTD is MIT!\r\n\r\nRead it [here][license].\r\n\r\n---\r\n\r\nEnjoy!\r\n\r\n[Oka.io](http://oka.io/) | [@Okahyphen](https://twitter.com/Okahyphen)\r\n\r\n[npm-url]: https://www.npmjs.com/package/mtd\r\n[npm-image]: http://img.shields.io/npm/v/mtd.svg\r\n[npm-downloads]: http://img.shields.io/npm/dm/mtd.svg\r\n\r\n[minimist]: https://www.npmjs.com/package/minimist\r\n[license]: https://github.com/Okahyphen/mtd/blob/master/LICENSE\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}